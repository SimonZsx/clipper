# docker build -f ./imagequery_w_proxy/Dockerfile1 -t imagequery_w_proxy:c1_ds .
# docker run -p 8000:8000 -it --runtime=nvidia imagequery_w_proxy:c1_ds

# - slow initialization:
# 1.14.0-gpu-py3
# 2.0.0b1-gpu-py3 
# tensorflow/tensorflow:1.12.0-gpu-py3
# - cuda error: 
# ubuntu:18.04
FROM nvidia/cuda:10.0-cudnn7-runtime-ubuntu18.04
RUN apt-get update && apt-get install curl wget sox swig -y
RUN apt-get update && apt-get install python3 python3-pip -y

RUN pip3 install --upgrade deepspeech-gpu

# Download pre-trained model
WORKDIR /container/models
RUN wget --progress=bar:force https://github.com/mozilla/DeepSpeech/releases/download/v0.5.1/deepspeech-0.5.1-models.tar.gz
RUN tar xvfz deepspeech-0.5.1-models.tar.gz

# Copy files
WORKDIR /container/data
ADD imagequery_w_proxy/c1_speechRecognition/data .

WORKDIR /container/app
ADD imagequery_w_proxy/c1_speechRecognition/app .

EXPOSE 8000