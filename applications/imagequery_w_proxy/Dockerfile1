# docker build -f ./imagequery_w_proxy/Dockerfile1 -t imagequery_w_proxy:c1_ds .
# docker run -p 8000:8000 -it --runtime=nvidia imagequery_w_proxy:c1_ds

# From Mozilla github repo Dockerfile beginning
# FROM nvidia/cuda:10.0-cudnn7-runtime-ubuntu18.04
# RUN apt-get update && apt-get install -y --no-install-recommends \
#         build-essential \
#         curl \
#         wget \
#         git \
#         python3 \
#         python3-dev \
#         python3-pip \
#         python3-wheel \
#         python3-numpy \
#         libcurl3-dev  \
#         ca-certificates \
#         gcc \
#         sox \
#         libsox-fmt-mp3 \
#         htop \
#         nano \
#         swig \
#         cmake \
#         libboost-all-dev \
#         zlib1g-dev \
#         libbz2-dev \
#         liblzma-dev \
#         locales \
#         pkg-config \
#         libsox-dev \
#         openjdk-8-jdk \
#         bash-completion \
#         g++ \
#         unzip

FROM tensorflow/tensorflow:2.0.0b1-gpu-py3 
RUN apt-get update
RUN apt-get install curl wget sox swig -y

# By YY:
# RUN apt-get install -y git
# RUN apt-get update && apt-get install -y git-lfs 
RUN pip3 install --upgrade deepspeech-gpu

# Download pre-trained model
WORKDIR /container/models
RUN wget --progress=bar:force https://github.com/mozilla/DeepSpeech/releases/download/v0.5.1/deepspeech-0.5.1-models.tar.gz
RUN tar xvfz deepspeech-0.5.1-models.tar.gz

# Copy files
WORKDIR /container/data
ADD imagequery_w_proxy/c1_ds/data .

WORKDIR /container/app
ADD imagequery_w_proxy/c1_ds/app .

EXPOSE 8000